<!-- html -->
{% extends 'base.html' %}

{% block title %}User | {{user.username}}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/user/user.css') }}">
<script src="{{ url_for('static', filename='js/user/user.js') }}" defer></script>
{% endblock %}

{% block body %}
<main class="profile-layout">
    <div class="user-wrapper">
        <section class="profile-grid" aria-label="User profile area">
            <div class="user-name">
                <h2>{{ user.username }}</h2>
            </div>
            <div class="user-info">
                <img src="{{image_path}}" alt="User Avatar" class="user-avatar">
                <div class="user-details">
                    <a href="/user/{{user.username}}/followers"><p id="followers">Followers: {{ user.follower_ids|length }}</p></a>
                    <p id="bio">{{ user.bio }}</p>
                    <p id="postCount" class="stat-line">Posts: {{ posts|length }}</p>
                </div>
            </div>
            <div class="user-follow-button-container">
                <button id="userFollowButton"
                        class="user-follow-button"
                        data-user-id="{{ user.id }}">
                  Follow
                </button>
            </div>
            <script>
            document.addEventListener('DOMContentLoaded', () => {
              const userId = {{ user.id | tojson }};
              function callWhenReady() {
                if (typeof window.setActivePostUser === 'function') {
                  try { window.setActivePostUser(userId); } catch (e) { console.error('setActivePostUser call failed', e); }
                  return;
                }
                setTimeout(callWhenReady, 20);
              }
              callWhenReady();
            });
            </script>
            <div class="posts-grid">
              {% for post_path_tuple in post_path_tuples %}
              <div class="post-item">
                  {%if user.username == session.get('user_name')%}
                      <div class="delete-post-btn">
                          <a href="/post/{{ post_path_tuple[0].id }}/delete" aria-label="Delete post" title="Delete post">
                            <img src="/static/images/assets/trash-can.png" alt="trash-can">
                          </a>
                      </div>
                  {% endif %}
                  <a href="/post/{{post_path_tuple[0].id}}">
                    <img src="{{post_path_tuple[1]}}" alt="post image" loading="lazy">
                  </a>
              </div>
              {% else %}
              <p>No posts yet.</p>
              {% endfor %}
            </div>
        </section>
    </div>
</main>
{% endblock %}
